<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Details</title>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f8f9fa; color: #333; }
        .container { padding-bottom: 80px; }
        .profile-header { display: flex; justify-content: center; align-items: center; padding: 16px; background-color: #f8f9fa; }
        .header-title { font-size: 18px; font-weight: 600; }
        .review-banner { background-color: #fef7e0; border-radius: 12px; padding: 16px; margin: 0 16px 24px 16px; display: flex; align-items: flex-start; gap: 12px; }
        .review-banner-icon { background-color: #ffb300; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; flex-shrink: 0; font-size: 16px; }
        .review-banner-text h4 { margin: 0 0 4px 0; font-size: 16px; }
        .review-banner-text p { margin: 0; font-size: 14px; color: #555; line-height: 1.4; }
        .profile-info { text-align: center; margin-bottom: 32px; }
        .profile-picture { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 16px auto; border: 3px solid white; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); background-color: #edf2f7; display: flex; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .profile-picture svg { width: 100%; height: 100%; }
        .profile-name { font-size: 22px; font-weight: 600; margin: 0; }
        .profile-id { font-size: 16px; color: #888; margin-top: 4px; }
        .form-section { padding: 0 16px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 14px; color: #666; margin-bottom: 8px; padding-left: 4px; }
        .form-group input { width: 100%; padding: 14px 16px; border: 1px solid #e0e0e0; border-radius: 12px; background-color: #fff; font-size: 16px; box-sizing: border-box; opacity: 1; color: #333; -webkit-text-fill-color: #333; transition: border-color 0.2s, box-shadow 0.2s; }
        .form-group input:disabled { cursor: not-allowed; background-color: #f8f9fa; }
        .form-group input:not(:disabled) { border-color: #007aff; box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2); }
        .name-section { display: flex; align-items: flex-end; gap: 10px; }
        .name-group { display: flex; gap: 10px; flex-grow: 1; }
        .name-group .form-group { flex: 1; margin-bottom: 0; }
        .email-input-group { display: flex; align-items: center; gap: 10px; }
        .email-input-group input { flex: 1; }
        .action-btn { background-color: #f0f0f0; border: 1px solid #e0e0e0; color: #007aff; font-weight: 600; border-radius: 12px; padding: 14px 16px; cursor: pointer; transition: background-color 0.2s; white-space: nowrap; }
        .action-btn.full-width { width: 100%; }
        .phone-group { display: flex; gap: 10px; }
        .phone-group .country-code { flex: 0 0 60px; }
        .phone-group .phone-number { flex: 1; }
        .delete-section { margin-top: 40px; padding: 0 16px; }
        .delete-btn { width: 100%; background: none; border: 1px solid #e53e3e; color: #e53e3e; font-size: 16px; font-weight: 600; cursor: pointer; padding: 14px; border-radius: 12px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: white; padding: 24px; border-radius: 16px; width: 85%; max-width: 400px; text-align: center; }
        .modal-content h3 { margin-top: 0; font-size: 18px; }
        .modal-content p { color: #666; font-size: 14px; margin-bottom: 16px; text-align: left; }
        .modal-content input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .modal-actions { display: flex; gap: 10px; margin-top: 16px; }
        .modal-actions button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
        .modal-cancel-btn { background: #e2e8f0; color: #4a5568; }
        .modal-confirm-btn { background: #e53e3e; color: white; }
        .modal-confirm-btn.blue { background-color: #007aff; }
        #phone-error, #email-error, #otp-error { color: #e53e3e; font-size: 12px; text-align: left; height: 15px; margin-bottom: 5px; }
        .terms-content { text-align: left; background-color: #f7fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; max-height: 150px; overflow-y: auto; margin: 16px 0; }
        .terms-content ul { list-style-type: disc; padding-left: 20px; margin: 0; }
        .terms-content li { margin-bottom: 10px; font-size: 13px; line-height: 1.5; }
        .checkbox-container { display: flex; align-items: center; justify-content: flex-start; gap: 8px; margin-top: 16px; }
        .checkbox-container label { font-size: 14px; color: #4a5568; }
        .btn-disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <header class="profile-header"><div class="header-title">Profile Details</div></header>
    <div class="container">
        <div class="review-banner">
            <div class="review-banner-icon">!</div>
            <div class="review-banner-text"><h4>Profile Details Under Review!</h4><p>Your profile details are currently being reviewed. You'll be notified once the process is complete.</p></div>
        </div>
        <div class="profile-info">
            <div class="profile-picture"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#a0aec0"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
            <h3 class="profile-name" id="profileName">Loading...</h3>
            <p class="profile-id">1234</p>
        </div>
        <div class="form-section">
            <div class="form-group">
                <label>Full Name</label>
                <div class="name-section">
                    <div class="name-group">
                        <div class="form-group"><input type="text" id="firstName" value="" disabled></div>
                        <div class="form-group"><input type="text" id="lastName" value="" disabled></div>
                    </div>
                    <button class="action-btn" id="editNameBtn">Edit</button>
                </div>
            </div>
            <div class="form-group">
                <label for="email">Email Address</label>
                <div id="email-display-container"></div>
            </div>
            <div class="form-group"><label for="phone">Phone Number</label><div class="phone-group"><input type="text" class="country-code" value="+94" disabled><input type="text" id="phone" class="phone-number" value="765694702" disabled></div></div>
            <div class="form-group"><label for="nic">NIC / Passport</label><input type="text" id="nic" value="997156826V" disabled></div>
            <div class="form-group"><label for="address">Address</label><input type="text" id="address" value="481/2, Kandy Road, Kandy" disabled></div>
        </div>
        <div class="delete-section"><button class="delete-btn" id="deleteAccountBtn">Delete Account</button></div>
    </div>

    <!-- Modal for Email and OTP Flow -->
    <div class="modal-overlay" id="emailModal">
        <div class="modal-content" id="emailModalContent"></div>
    </div>
    
    <!-- Modals for Deletion Flow -->
    <div class="modal-overlay" id="termsConfirmModal">
        <div class="modal-content">
            <h3>Account Deletion Terms</h3>
            <div class="terms-content">
                <p>By proceeding, you acknowledge and agree to the following:</p>
                <ul><li>This action is <strong>permanent and irreversible</strong>.</li><li>All personal data associated with your account will be permanently erased.</li><li>All registered warranties and service records will be deleted.</li><li>Your deletion request will be processed and completed within <strong>7 business days</strong>.</li></ul>
            </div>
            <div class="checkbox-container"><input type="checkbox" id="termsCheckbox"><label for="termsCheckbox">I have read and agree to these terms.</label></div>
            <div class="modal-actions"><button class="modal-cancel-btn" id="cancelTermsBtn">Cancel</button><button class="modal-confirm-btn btn-disabled" id="continueToPhoneBtn" disabled>Continue</button></div>
        </div>
    </div>
    <div class="modal-overlay" id="phoneConfirmModal">
        <div class="modal-content">
            <h3>Confirm Deletion</h3>
            <p>To continue, please enter your mobile number ending in ••02.</p>
            <div id="phone-error"></div><input type="tel" id="phoneConfirmInput" placeholder="+94 76 569 4702">
            <div class="modal-actions"><button class="modal-cancel-btn" id="cancelDeleteBtn">Cancel</button><button class="modal-confirm-btn" id="confirmDeleteBtn">Continue</button></div>
        </div>
    </div>
    <div class="modal-overlay" id="phoneConfirmModal">
        <div class="modal-content">
            <h3>Confirm Deletion</h3>
            <p>To continue, please enter your mobile number ending in ••02.</p>
            <div id="phone-error"></div><input type="tel" id="phoneConfirmInput" placeholder="+94 76 569 4702">
            <div class="modal-actions"><button class="modal-cancel-btn" id="cancelDeleteBtn">Cancel</button><button class="modal-confirm-btn" id="confirmDeleteBtn">Continue</button></div>
        </div>
    </div>

    <script>
        // --- User Data (Simulated & Loaded) ---
        let userEmail = localStorage.getItem('userEmail') || null; // Load email from localStorage
        const userPhoneNumber = "765694702";
        let generatedOtp = null;
        let pendingEmail = null;
        
        // --- Element References ---
        const profileName = document.getElementById('profileName');
        const firstNameInput = document.getElementById('firstName');
        const lastNameInput = document.getElementById('lastName');
        const editNameBtn = document.getElementById('editNameBtn');
        const emailDisplayContainer = document.getElementById('email-display-container');
        const emailModal = document.getElementById('emailModal');
        const emailModalContent = document.getElementById('emailModalContent');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const termsConfirmModal = document.getElementById('termsConfirmModal');
        const cancelTermsBtn = document.getElementById('cancelTermsBtn');
        const continueToPhoneBtn = document.getElementById('continueToPhoneBtn');
        const termsCheckbox = document.getElementById('termsCheckbox');
        const phoneConfirmModal = document.getElementById('phoneConfirmModal');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const phoneConfirmInput = document.getElementById('phoneConfirmInput');
        const phoneError = document.getElementById('phone-error');
        
        // --- Load User Data ---
        function loadUserData() {
            const firstName = localStorage.getItem('userFirstName') || 'Guest';
            const lastName = localStorage.getItem('userLastName') || 'User';
            firstNameInput.value = firstName;
            lastNameInput.value = lastName;
            profileName.textContent = `${firstName} ${lastName}`;
        }

        // --- Name Editing Logic ---
        editNameBtn.addEventListener('click', () => {
            if (editNameBtn.textContent === 'Edit') {
                firstNameInput.disabled = false;
                lastNameInput.disabled = false;
                editNameBtn.textContent = 'Save';
                firstNameInput.focus();
            } else {
                const newFirstName = firstNameInput.value.trim();
                const newLastName = lastNameInput.value.trim();
                if (newFirstName === '' || newLastName === '') {
                    alert('Names cannot be empty.');
                    return;
                }
                firstNameInput.disabled = true;
                lastNameInput.disabled = true;
                editNameBtn.textContent = 'Edit';
                profileName.textContent = `${newFirstName} ${newLastName}`;
                localStorage.setItem('userFirstName', newFirstName);
                localStorage.setItem('userLastName', newLastName);
                alert('Name updated successfully!');
            }
        });

        // --- Email and OTP Logic ---
        function renderEmailSection() {
            emailDisplayContainer.innerHTML = '';
            if (userEmail) {
                emailDisplayContainer.innerHTML = `<div class="email-input-group"><input type="email" id="email" value="${userEmail}" disabled><button class="action-btn" id="changeEmailBtn">Change</button></div>`;
                document.getElementById('changeEmailBtn').addEventListener('click', () => openEmailModal('change'));
            } else {
                emailDisplayContainer.innerHTML = `<button class="action-btn full-width" id="addEmailBtn">Add Email Address</button>`;
                document.getElementById('addEmailBtn').addEventListener('click', () => openEmailModal('add'));
            }
        }

        function openEmailModal(mode) {
            renderEmailForm(mode);
            emailModal.classList.add('show');
        }

        function renderEmailForm(mode) {
            const title = mode === 'add' ? 'Add Email Address' : 'Change Email Address';
            const text = mode === 'add' ? 'Please enter your email to add it to your profile.' : 'Please enter your new email address.';
            const inputValue = mode === 'add' ? '' : userEmail;
            emailModalContent.innerHTML = `<h3>${title}</h3><p>${text}</p><div id="email-error"></div><input type="email" id="emailInput" placeholder="example@email.com" value="${inputValue}"><div class="modal-actions"><button class="modal-cancel-btn" id="cancelEmailBtn">Cancel</button><button class="modal-confirm-btn blue" id="sendOtpBtn">Continue</button></div>`;
            document.getElementById('cancelEmailBtn').addEventListener('click', closeEmailModal);
            document.getElementById('sendOtpBtn').addEventListener('click', initiateEmailVerification);
        }

        function initiateEmailVerification() {
            const emailInput = document.getElementById('emailInput');
            const emailError = document.getElementById('email-error');
            pendingEmail = emailInput.value.trim();
            if (pendingEmail === '' || !pendingEmail.includes('@') || !pendingEmail.includes('.')) {
                emailError.textContent = 'Please enter a valid email address.';
                return;
            }
            generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
            alert(`(Simulation) OTP sent to ${pendingEmail}: ${generatedOtp}`);
            renderOtpForm();
        }

        function renderOtpForm() {
            emailModalContent.innerHTML = `<h3>Verify Email</h3><p>An OTP has been sent to <strong>${pendingEmail}</strong>. Please enter it below.</p><div id="otp-error"></div><input type="tel" id="otpInput" placeholder="Enter 6-digit OTP" maxlength="6"><div class="modal-actions"><button class="modal-cancel-btn" id="cancelOtpBtn">Cancel</button><button class="modal-confirm-btn blue" id="verifyOtpBtn">Verify</button></div>`;
            document.getElementById('cancelOtpBtn').addEventListener('click', closeEmailModal);
            document.getElementById('verifyOtpBtn').addEventListener('click', verifyOtp);
        }

        function verifyOtp() {
            const otpInput = document.getElementById('otpInput');
            const otpError = document.getElementById('otp-error');
            if (otpInput.value === generatedOtp) {
                userEmail = pendingEmail;
                localStorage.setItem('userEmail', userEmail); // Save email to localStorage
                closeEmailModal();
                renderEmailSection();
                alert('Email verified and updated successfully!');
            } else {
                otpError.textContent = 'Invalid OTP. Please try again.';
            }
        }

        function closeEmailModal() {
            emailModal.classList.remove('show');
            pendingEmail = null;
            generatedOtp = null;
        }

        // --- Deletion Flow Logic ---
        deleteAccountBtn.addEventListener('click', () => termsConfirmModal.classList.add('show'));
        cancelTermsBtn.addEventListener('click', () => {
            termsConfirmModal.classList.remove('show');
            termsCheckbox.checked = false;
            continueToPhoneBtn.disabled = true;
            continueToPhoneBtn.classList.add('btn-disabled');
        });
        termsCheckbox.addEventListener('change', () => {
            continueToPhoneBtn.disabled = !termsCheckbox.checked;
            continueToPhoneBtn.classList.toggle('btn-disabled', !termsCheckbox.checked);
        });
        continueToPhoneBtn.addEventListener('click', () => {
            termsConfirmModal.classList.remove('show');
            phoneConfirmModal.classList.add('show');
        });
        cancelDeleteBtn.addEventListener('click', () => {
            phoneConfirmModal.classList.remove('show');
            phoneConfirmInput.value = '';
            phoneError.textContent = '';
        });
        confirmDeleteBtn.addEventListener('click', () => {
            const enteredNumber = phoneConfirmInput.value.replace(/\D/g, '');
            if (enteredNumber.endsWith(userPhoneNumber)) {
                window.location.href = 'otp_verify.html';
            } else {
                phoneError.textContent = 'The phone number does not match.';
            }
        });

        // --- Initial Render ---
        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
            renderEmailSection();
        });
    </script>
</body>
</html>